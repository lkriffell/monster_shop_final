<section class='statistics'>
  <h3>Most Popular Items:</h3>
  <% @items.by_popularity(5, "DESC").each do |item| %>
    <li><%= item.name %>: <%= item.total_sold %> sold</li>
  <% end %>
  <h3>Least Popular Items:</h3>
  <% @items.by_popularity(5, "ASC").each do |item| %>
    <li><%= item.name %>: <%= item.total_sold %> sold</li>
  <% end %>
</section>

<% @items.each do |item| %>
  <section id='item-<%= item.id%>'>
    <h2><%= link_to item.name, "/items/#{item.id}" %></h2>
    <p><%= item.description %></p>
    <%= link_to(image_tag(item.image), item_path(item), id: 'image') %>
    <p>Price: <%= number_to_currency(item.price) %></p>
    <p>Sold by: <%= link_to item.merchant.name, "/merchants/#{item.merchant_id}" %>, Inventory: <%= item.inventory %></p>
    <% if item.merchant.discounts%>
      <% item.merchant.discounts.each do |discount| %>
        <p>Discount: <%= discount.percent_off * 100 %>% off <%= discount.min_quantity %> items or more</p>
        <% if current_merchant_user? %>
        <%= link_to "Remove Discount", "/merchant/#{item.merchant.id}/discount/#{discount.id}/destroy", method: :delete %>
        <%= link_to "Edit Bulk Discount", "/merchant/#{item.merchant.id}/discount/#{discount.id}/edit" %><br>
        <% end %>
      <% end %>
    <% end %>
    <p><%= item.active ? "Active" : "Inactive" %></p>
    <% if current_merchant_user? %>
      <% if item.active? %>
        <%= button_to 'Inactivate', "/merchant/items/#{item.id}/change_status", method: :put %>
      <% elsif !item.active? %>
        <%= button_to 'Activate', "/merchant/items/#{item.id}/change_status", method: :put %>
      <% end %>
      <%= link_to 'Update Item', "/merchant/items/#{item.id}/edit" %>
      <%= button_to 'Delete', "/merchant/items/#{item.id}", method: :delete if item.orders.empty? %>
    <% end %>
    <% if current_merchant_user? %>
    <br><%= link_to "Create Bulk Discount", "/merchant/#{item.merchant.id}/discount/new" %><br>
    <% end %>
  </section>
<% end %>
